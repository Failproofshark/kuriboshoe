var GameTrackerShared={};GameTrackerShared.TrackerForm=function(e){this.fields=e,this.populateForm=function(e){var r=this;e.attributes?_.map(e.attributes,function(e,n){"id"!==n&&r.fields[n](e)}):_.map(e,function(e,n){"id"!==n&&r.fields[n](e)})},this.clearForm=_.forEach.bind(this,this.fields,function(e){e(_.isString(e())?"":_.isArray(e())?[]:_.isBoolean(e())?!1:null)}),this.returnFields=function(){return _.mapValues(this.fields,function(e){var r=e();return _.isBoolean(r)&&(r=Number(r)),r})},this.submitHandlers={},this.submitHandlers.search=function(){},this.getSubmitHandler=function(e){return this.submitHandlers[e]}};var GameForm={};GameForm.controller=new function(){this.gameForm=new GameTrackerShared.TrackerForm({name:m.prop(""),blurb:m.prop(""),region:m.prop(""),hasmanual:m.prop(0),hasbox:m.prop(0),notes:m.prop(""),quantity:m.prop(""),genres:m.prop([]),companies:m.prop([]),systemid:m.prop("")}),this.errorMessage="",this.isLoading=!1,this.searchResults=[],this.noResults="",this.formMode="search",this.isAdmin=!1,this.searchLoading=!1,this.selectUpdateHandler,this.selectDeleteHandler,this.cancelButtonHandler,this.systems,this.genres,this.companies,this.addCompanyHandler=function(){},this.addGenreHandler=function(){},this.addSystemHandler=function(){},this.populateSelectDataSets=function(e,r,n){this.systems=e,this.genres=r,this.companies=n},this.adminResultButtonHandlers=function(e,r){this.selectUpdateHandler=e,this.selectDeleteHandler=r},this.bindSubmitFormHandler=function(e,r){this.gameForm.submitHandlers[e]=r},this.titleClickHandler=function(){},this.gameForm.submitHandlers.search=function(){GameForm.controller.noResults="",GameForm.controller.isLoading=!0;var e=_.omit(GameForm.controller.gameForm.returnFields(),function(e){var r=!0;return _.isBoolean(e)?r=!e:_.isEmpty(e)||(r=!1),r});return _.isEmpty(e)?(GameForm.controller.errorMessage="Please enter at least one search parameter",GameForm.controller.isLoading=!1):(GameForm.controller.errorMessage="",m.request({method:"post",url:"/search-games-ajax/",data:e}).then(function(e){GameForm.controller.searchResults=_.remove(e.results,function(e){return!_.isNull(e)}),GameForm.controller.searchResults.length<1&&(GameForm.controller.noResults="No matches were found"),GameForm.controller.isLoading=!1},function(){GameForm.controller.errorMessage="Internal Server Error"})),!1}},GameForm.view=function(){var e={textAreaDisplay:function(){var e="search"===GameForm.controller.formMode?"display:none":"display:inherit";return e},actionButtonDisplay:function(){var e=GameForm.controller.isLoading?"display:none":"display:inline";return e},preloaderDisplay:function(){var e=GameForm.controller.isLoading?"display:inherit":"display:none";return e},changeFormProperties:function(){var e="cursor:pointer;";return e+=GameForm.controller.isAdmin?"display:inherit":"display:none"}},r=function(){var e=[],r=GameForm.controller.searchLoading?{results:"display:none",preloader:"display:inherit"}:{results:"display:inherit",preloader:"display:none"},n=GameForm.controller.isAdmin?"cursor:default":"cursor:pointer",t=function(e){var r=[];return GameForm.controller.isAdmin&&(r=m("div.col-xs-3",[m("span.glyphicon.glyphicon-remove.game-search-results-button",{onclick:GameForm.controller.selectDeleteHandler.bind(GameForm.controller,e.id)}),m("span.glyphicon.glyphicon-pencil.game-search-results-button",{onclick:GameForm.controller.selectUpdateHandler.bind(GameForm.controller,e.id)})])),r};return _.isEmpty(GameForm.controller.searchResults)&&_.isEmpty(GameForm.controller.noResults)||(e=m("div",{style:r.results},[m("div",GameForm.controller.noResults),_.map(GameForm.controller.searchResults,function(e,r){var a="background-color:#CECFE0";return r%2==0&&(a="background-color:#FFF"),m("div.row.result-row",{style:a},[m("div.col-xs-9",{style:a},[m("span",{style:n,onclick:GameForm.controller.titleClickHandler.bind(GameForm.controller,e.id)},e.name+" ["+e.region+"] ("+e.systemName+")")]),t(e)])}),m("img[src=/images/ajax.gif]",{style:r.preloader})])),e};return[m("div.row",[m("div.col-xs-12",[m("div.text-danger",GameForm.controller.errorMessage),m("form",[m("input.form-control",{onchange:m.withAttr("value",GameForm.controller.gameForm.fields.name),value:GameForm.controller.gameForm.fields.name(),placeholder:"Name"}),select2.view({onchange:GameForm.controller.gameForm.fields.region,value:GameForm.controller.gameForm.fields.region(),select2InitializationOptions:{placeholder:"Region",allowClear:!0}},["NTSC","NTSC-J","PAL"]),m("div",[select2.view({onchange:GameForm.controller.gameForm.fields.systemid,value:GameForm.controller.gameForm.fields.systemid(),select2InitializationOptions:{placeholder:"System",allowClear:!0}},GameForm.controller.systems),m("u",{style:e.changeFormProperties(),onclick:GameForm.controller.addSystemHandler},"+Add System")]),m("div",[select2.view({onchange:GameForm.controller.gameForm.fields.genres,value:GameForm.controller.gameForm.fields.genres(),select2InitializationOptions:{placeholder:"Genres",allowClear:!0}},GameForm.controller.genres,!0),m("u",{style:e.changeFormProperties(),onclick:GameForm.controller.addGenreHandler},"+Add Genre")]),m("div",[select2.view({onchange:GameForm.controller.gameForm.fields.companies,value:GameForm.controller.gameForm.fields.companies(),select2InitializationOptions:{placeholder:"Companies",allowClear:!0}},GameForm.controller.companies,!0),m("u",{style:e.changeFormProperties(),onclick:GameForm.controller.addCompanyHandler},"+Add Company")]),m("input.form-control",{onchange:m.withAttr("value",GameForm.controller.gameForm.fields.quantity),value:GameForm.controller.gameForm.fields.quantity(),placeholder:"Quantity"}),m("div",{style:e.textAreaDisplay()},[m("p","Short Description"),m("textarea",{onchange:m.withAttr("value",GameForm.controller.gameForm.fields.blurb)},GameForm.controller.gameForm.fields.blurb())]),m("div.checkbox",[m("label",[m("input[type=checkbox]",{onchange:m.withAttr("checked",GameForm.controller.gameForm.fields.hasmanual),checked:GameForm.controller.gameForm.fields.hasmanual()})]),m("span","Manual")]),m("div.checkbox",[m("label",[m("input[type=checkbox]",{onchange:m.withAttr("checked",GameForm.controller.gameForm.fields.hasbox),checked:GameForm.controller.gameForm.fields.hasbox()})]),m("span","Box")]),m("div",{style:e.textAreaDisplay()},[m("p","Notes"),m("textarea",{onchange:m.withAttr("value",GameForm.controller.gameForm.fields.notes)},GameForm.controller.gameForm.fields.notes())]),m("div",[m("button.btn.btn-success",{style:e.actionButtonDisplay(),onclick:GameForm.controller.gameForm.submitHandlers[GameForm.controller.formMode]},"submit"),m("button.btn.btn-danger",{style:e.actionButtonDisplay(),onclick:GameForm.controller.cancelButtonHandler},"cancel"),m("img[src=/images/ajax.gif]",{style:e.preloaderDisplay()})])])])]),r()]};var GameTrackerAdmin={};GameTrackerAdmin.Model=function(e,r){return function(n){this.attributes=n?_.isEmpty(n.id)?_.extend({id:null},_.clone(n,!0)):_.clone(n):e,this.backsideUrl=r,this.save=function(){var e=this;return m.request({method:"POST",url:e.backsideUrl,data:_.omit(e.attributes,"id")}).then(function(r){return e.attributes.id=r.newid,r})},this.update=function(e){var r=this;return _.forIn(e,function(e,n){r.attributes[n]=e}),m.request({method:"PUT",url:r.backsideUrl,data:r.attributes})},this.remove=function(){var e=this;return m.request({method:"DELETE",url:e.backsideUrl,data:{id:e.attributes.id}})}}},GameTrackerAdmin.Company=GameTrackerAdmin.Model({id:null,name:"",ismanufacturer:null},"/thosewhodarenotwander/company/"),GameTrackerAdmin.System=GameTrackerAdmin.Model({id:null,name:"",manufacturerid:null},"/thosewhodarenotwander/system/"),GameTrackerAdmin.Genre=GameTrackerAdmin.Model({id:null,name:"",manufacturerid:null},"/thosewhodarenotwander/genre/"),GameTrackerAdmin.screenHelpers={},GameTrackerAdmin.screenHelpers.createButtonDisplayProperties=function(e){var r=e?{button:"display:none",preloader:"display:inline"}:{button:"display:inline",preloader:"display:none"};return r},GameTrackerAdmin.screenHelpers.createButtonSet=function(e,r){var n=GameTrackerAdmin.screenHelpers.createButtonDisplayProperties(e);return m("div",[m("button.btn.btn-success",{style:n.button,onclick:GameTrackerAdmin.vm[r].submitHandlers[GameTrackerAdmin.vm.formMode]},"submit"),m("button.btn.btn-danger",{style:n.button,onclick:GameTrackerAdmin.vm.returnToMainForm.bind(GameTrackerAdmin.vm,r)},"cancel"),m("img[src=/images/ajax.gif]",{style:n.preloader})])},GameTrackerAdmin.screenCollection={},GameTrackerAdmin.screenCollection.InitialScreen=function(){return m("div#initialAdmin","Welcome to the Kuribo Shoe Admin Panel")},GameTrackerAdmin.screenCollection.SelectScreen=function(){var e=GameTrackerAdmin.screenHelpers.createButtonDisplayProperties(GameTrackerAdmin.vm.isLoading),r=function(){var e=[];switch(GameTrackerAdmin.vm.selectScreenState){case"system":e=_.pluck(GameTrackerAdmin.vm.systems,"attributes");break;case"company":e=_.pluck(GameTrackerAdmin.vm.companies,"attributes");break;case"genre":e=_.pluck(GameTrackerAdmin.vm.genres,"attributes")}return e};return m("div.row",[m("div.col-xs-12",[m("form",[m("div",[select2.view({onchange:GameTrackerAdmin.vm.currentSelectEntityId,value:GameTrackerAdmin.vm.currentSelectEntityId(),select2InitializationOptions:{placeholder:"Select an item to edit or delete"}},r())]),m("div",[m("button.btn.btn-success",{style:e.button,onclick:GameTrackerAdmin.vm.generalInitiateEdit},"edit"),m("button.btn.btn-danger",{style:e.button,onclick:GameTrackerAdmin.vm.generalDelete},"delete"),m("img[src=/images/ajax.gif]",{style:e.preloader})])])])])},GameTrackerAdmin.screenCollection.CompanyFormScreen=function(){return m("div.row",[m("div.col-xs-12",[m("form",[m("input.form-control[type=text]",{placeholder:"Company Name",onchange:m.withAttr("value",GameTrackerAdmin.vm.companyForm.fields.name),value:GameTrackerAdmin.vm.companyForm.fields.name()}),m("div.checkbox",[m("label",[m("input[type=checkbox]",{onchange:m.withAttr("checked",GameTrackerAdmin.vm.companyForm.fields.ismanufacturer),checked:GameTrackerAdmin.vm.companyForm.fields.ismanufacturer()})]),m("span","Is this company a console manufacuturer?")]),GameTrackerAdmin.screenHelpers.createButtonSet(GameTrackerAdmin.vm.isLoading,"companyForm")])])])},GameTrackerAdmin.screenCollection.GenreFormScreen=function(){return m("div.row",[m("div.col-xs-12",[m("form",[m("input.form-control[type=text]",{placeholder:"Genre Name",onchange:m.withAttr("value",GameTrackerAdmin.vm.genreForm.fields.name),value:GameTrackerAdmin.vm.genreForm.fields.name()}),GameTrackerAdmin.screenHelpers.createButtonSet(GameTrackerAdmin.vm.isLoading,"genreForm")])])])},GameTrackerAdmin.screenCollection.SystemFormScreen=function(){var e=function(){return _.filter(_.pluck(GameTrackerAdmin.vm.companies,"attributes"),{ismanufacturer:1})};return m("div.row",[m("div.col-xs-12",[m("form",[m("input.form-control[type=text]",{placeholder:"System Name",onchange:m.withAttr("value",GameTrackerAdmin.vm.systemForm.fields.name),value:GameTrackerAdmin.vm.systemForm.fields.name()}),m("div",[select2.view({onchange:GameTrackerAdmin.vm.systemForm.fields.manufacturerid,value:GameTrackerAdmin.vm.systemForm.fields.manufacturerid(),select2InitializationOptions:{placeholder:"Manufacturer"}},e()),m("u[style=cursor:pointer]",{onclick:GameTrackerAdmin.vm.changeToAddCompany},"+Add Company")]),GameTrackerAdmin.screenHelpers.createButtonSet(GameTrackerAdmin.vm.isLoading,"systemForm")])])])},GameTrackerAdmin.screenCollection.GameFormScreen=GameForm.view,GameTrackerAdmin.view=function(){var e=function(){return _.map(GameTrackerAdmin.screenCollection,function(e,r){return m("div",{style:"display:"+GameTrackerAdmin.vm.shouldDisplayScreen(r)},e())})};return[m("nav.navbar.navbar-default",[m("div.container-fluid",[m("div.navbar-header",[m("button.navbar-toggle.collapsed[type=button][data-toggle=collapse][data-target=#main-nav]",[m("span.icon-bar"),m("span.icon-bar"),m("span.icon-bar")])]),m("div#main-nav.collapse.navbar-collapse",[m("ul.nav.navbar-nav",[m("li.dropdown",[m("a[href=#].dropdown-toggle[data-toggle=dropdown][role=button]","Games"),m("ul.dropdown-menu[role=menu]",[m("li",[m("a[href=#]",{onclick:GameTrackerAdmin.vm.jumpToScreen.bind(GameTrackerAdmin.vm,"add","game","GameFormScreen")},"Add Game")]),m("li",[m("a[href=#]",{onclick:GameTrackerAdmin.vm.jumpToScreen.bind(GameTrackerAdmin.vm,"search","game","GameFormScreen")},"Edit/Delete Game")])])]),m("li.dropdown",[m("a[href=#].dropdown-toggle[data-toggle=dropdown][role=button]","Systems"),m("ul.dropdown-menu[role=menu]",[m("li",[m("a[href=#]",{onclick:GameTrackerAdmin.vm.jumpToScreen.bind(GameTrackerAdmin.vm,"add","system","SystemFormScreen")},"Add System")]),m("li",[m("a[href=#]",{onclick:GameTrackerAdmin.vm.jumpToScreen.bind(GameTrackerAdmin.vm,"search","system","SelectScreen")},"Edit/Delete System")])])]),m("li.dropdown",[m("a[href=#].dropdown-toggle[data-toggle=dropdown][role=button]","Genre"),m("ul.dropdown-menu[role=menu]",[m("li",[m("a[href=#]",{onclick:GameTrackerAdmin.vm.jumpToScreen.bind(GameTrackerAdmin.vm,"add","genre","GenreFormScreen")},"Add Genre")]),m("li",[m("a[href=#]",{onclick:GameTrackerAdmin.vm.jumpToScreen.bind(GameTrackerAdmin.vm,"search","genre","SelectScreen")},"Edit/Delete Genre")])])]),m("li.dropdown",[m("a[href=#].dropdown-toggle[data-toggle=dropdown][role=button]","Company"),m("ul.dropdown-menu[role=menu]",[m("li",[m("a[href=#]",{onclick:GameTrackerAdmin.vm.jumpToScreen.bind(GameTrackerAdmin.vm,"add","company","CompanyFormScreen")},"Add Company")]),m("li",[m("a[href=#]",{onclick:GameTrackerAdmin.vm.jumpToScreen.bind(GameTrackerAdmin.vm,"search","company","SelectScreen")},"Edit/Delete Company")])])])])])])]),m("div.container",[m("div.text-success",GameTrackerAdmin.vm.successMessage),m("div.text-danger",GameTrackerAdmin.vm.errorMessage),e()])]},GameTrackerAdmin.vm=new function(){var e={};return e.init=function(){e.formMode="",e.selectScreenState="",e.screenHistory=["InitialScreen"],e.successMessage="",e.errorMessage="",e.reportInternalError=function(){e.errorMessage="Internal Server Error",e.isLoading=!1},e.clearMessages=function(){e.successMessage="",e.errorMessage="",e.noResults=""},e.completeReset=function(){e.clearMessages(),e.searchResults=[],e.systemForm.clearForm(),e.genreForm.clearForm(),e.companyForm.clearForm(),GameForm.controller.gameForm.clearForm(),e.currentSelectEntityId("")},e.jumpToScreen=function(r,n,t){return e.completeReset(),e.formMode=r,GameForm.controller.formMode=r,e.selectScreenState=n,e.screenHistory=[t,"InitialScreen"],!1},e.isLoading=!1,e.companies=_.map(companies,function(e){return new GameTrackerAdmin.Company(e)}),e.genres=_.map(genres,function(e){return new GameTrackerAdmin.Genre(e)}),e.systems=_.map(systems,function(e){return new GameTrackerAdmin.System(e)}),e.shouldDisplayScreen=function(r){var n="none";return _.isEmpty(e.screenHistory)||(n=r===e.screenHistory[0]?"inherit":"none"),n},e.createBackButton=function(r){return function(){r(),e.screenHistory.shift()}},e.returnToMainForm=function(r){return e[r].clearForm(),e.screenHistory.shift(),!1},e.generateChangeHandler=function(r){return function(){e.screenHistory.unshift(r),e.formMode="add"}},e.companyForm=new GameTrackerShared.TrackerForm({name:m.prop(""),ismanufacturer:m.prop(0)}),e.companyForm.submitHandlers.add=function(){if(e.isLoading=!0,e.clearMessages(),_.isEmpty(e.companyForm.fields.name()))e.errorMessage="Please enter the name of the company";else{var r=new GameTrackerAdmin.Company(e.companyForm.returnFields());r.save().then(function(n){"success"===n.status?(m.startComputation(),e.companies.push(r),GameForm.controller.companies=_.pluck(e.companies,"attributes"),e.successMessage="The company has been added",e.companyForm.clearForm(),e.isLoading=!1,m.endComputation()):(e.errorMessage="Could not add the company",e.isLoading=!1)},e.reportInternalError)}return!1},e.currentCompanyIndex=null,e.companyForm.submitHandlers.update=function(){return e.isLoading=!0,e.clearMessages(),_.isNull(e.currentCompanyIndex)||_.isEmpty(e.companyForm.fields.name())?(e.errorMessage="Please enter the name of the company",e.isLoading=!1):e.companies[e.currentCompanyIndex].update(e.companyForm.returnFields()).then(function(){e.successMessage="The company has been updated",e.isLoading=!1},e.reportInternalError),!1},e.genreForm=new GameTrackerShared.TrackerForm({name:m.prop("")}),e.genreForm.submitHandlers.add=function(){if(e.isLoading=!0,e.clearMessages(),_.isEmpty(e.genreForm.fields.name()))e.errorMessage="Please enter the name of the genre",e.isLoading=!1;else{var r=new GameTrackerAdmin.Genre(e.genreForm.returnFields());r.save().then(function(n){"success"===n.status?(e.genres.push(r),GameForm.controller.genres=_.pluck(e.genres,"attributes"),e.successMessage="The genre has been added",e.genreForm.clearForm(),e.isLoading=!1):(e.errorMessage="Could not add the genre",e.isLoading=!1)},e.reportInternalError)}return!1},e.currentGenreIndex=null,e.genreForm.submitHandlers.update=function(){return e.isLoading=!0,e.clearMessages(),_.isNull(e.currentGenreIndex)||_.isEmpty(e.genreForm.fields.name())?(e.errorMessage="Please enter the name of the genre",e.isLoading=!1):e.genres[e.currentGenreIndex].update(e.genreForm.returnFields()).then(function(){e.successMessage="The genre has been updated",e.isLoading=!1},e.reportInternalError),!1},e.changeToAddCompany=e.generateChangeHandler("CompanyFormScreen"),e.systemForm=new GameTrackerShared.TrackerForm({name:m.prop(""),manufacturerid:m.prop("")}),e.systemForm.submitHandlers.add=function(){if(e.isLoading=!0,e.clearMessages(),_.isEmpty(e.systemForm.fields.name())||_.isEmpty(e.systemForm.fields.manufacturerid()))e.errorMessage="Please fill in all of the fields",e.isLoading=!1;else{var r=new GameTrackerAdmin.System(e.systemForm.returnFields());r.save().then(function(n){"success"===n.status&&(e.systems.push(r),GameForm.controller.systems=_.pluck(e.systems,"attributes"),e.successMessage="The system has been added",e.systemForm.clearForm(),e.isLoading=!1)},e.reportInternalError)}return!1},e.currentSystemIndex=null,e.systemForm.submitHandlers.update=function(){return e.isLoading=!0,e.clearMessages(),_.isNull(e.currentSystemIndex)||_.isEmpty(e.systemForm.fields.name())||_.isEmpty(e.systemForm.fields.manufacturerid())?(e.errorMessage="Please fill in all the fields",e.isLoading=!1):e.systems[e.currentSystemIndex].update(e.systemForm.returnFields()).then(function(){e.successMessage="The system has been updated",e.isLoading=!1}),!1},GameForm.controller.isAdmin=!0,GameForm.controller.addCompanyHandler=e.generateChangeHandler("CompanyFormScreen"),GameForm.controller.addGenreHandler=e.generateChangeHandler("GenreFormScreen"),GameForm.controller.addSystemHandler=e.generateChangeHandler("SystemFormScreen"),GameForm.controller.populateSelectDataSets(_.pluck(e.systems,"attributes"),_.pluck(e.genres,"attributes"),_.pluck(e.companies,"attributes")),GameForm.controller.cancelButtonHandler=function(){GameForm.controller.gameForm.clearForm(),e.screenHistory.shift()},GameForm.controller.bindSubmitFormHandler("add",function(){return GameForm.controller.isLoading=!0,!_.isEmpty(GameForm.controller.gameForm.fields.name())&&!_.isEmpty(GameForm.controller.gameForm.fields.region())&&_.isFinite(Number(GameForm.controller.gameForm.fields.systemid()))&&Number(GameForm.controller.gameForm.fields.systemid())>0&&_.isFinite(Number(GameForm.controller.gameForm.fields.quantity()))&&Number(GameForm.controller.gameForm.fields.quantity())>0?m.request({method:"POST",url:"/thosewhodarenotwander/game/",data:GameForm.controller.gameForm.returnFields()}).then(function(){GameForm.controller.gameForm.clearForm(),e.successMessage="Successfully added the game",GameForm.controller.isLoading=!1},e.reportInternalError):(e.errorMessage="Please fill in all the fields",GameForm.controller.isLoading=!1),!1}),e.currentGameId=0,GameForm.controller.selectUpdateHandler=function(r){if(GameForm.controller.searchLoading=!0,r&&_.isFinite(Number(r))){var n=function(e){var r=_.isArray(e)?e:[e];return r};m.request({method:"GET",url:"/game/",data:{id:Number(r)}}).then(function(r){e.currentGameId=Number(r.id),GameForm.controller.gameForm.fields.companies(_.pluck(n(r.companies),"companyId")),GameForm.controller.gameForm.fields.genres(_.pluck(n(r.genres),"genreId")),GameForm.controller.gameForm.populateForm(_.omit(r,["companies","genres"])),GameForm.controller.formMode="update",GameForm.controller.searchResults=[],GameForm.controller.searchLoading=!1},e.reportInternalError)}},GameForm.controller.bindSubmitFormHandler("update",function(){if(GameForm.controller.isLoading=!0,!_.isEmpty(GameForm.controller.gameForm.fields.name())&&!_.isEmpty(GameForm.controller.gameForm.fields.region())&&_.isFinite(Number(GameForm.controller.gameForm.fields.systemid()))&&Number(GameForm.controller.gameForm.fields.systemid())>0&&_.isFinite(Number(GameForm.controller.gameForm.fields.quantity()))&&Number(GameForm.controller.gameForm.fields.quantity())>0){var r=_.extend({id:Number(e.currentGameId)},GameForm.controller.gameForm.returnFields());m.request({method:"PUT",url:"/thosewhodarenotwander/game/",data:r}).then(function(r){"success"===r.status&&(e.successMessage="Game successfully updated",GameForm.controller.isLoading=!1)},e.reportInternalError)}else e.errorMessage="Please fill in the fields",GameForm.controller.isLoading=!1;return!1}),GameForm.controller.selectDeleteHandler=function(r){return GameForm.controller.searchLoading=!0,r&&_.isFinite(Number(r))&&m.request({method:"DELETE",url:"/thosewhodarenotwander/game/",data:{id:Number(r)}}).then(function(n){"success"===n.status&&(e.successMessage="The game has been deleted",_.remove(GameForm.controller.searchResults,function(e){return e.id===Number(r)}),GameForm.controller.searchLoading=!1)},e.reportInternalError),!1},e.currentSelectEntityId=m.prop(""),e.generalInitiateEdit=function(){if(e.clearMessages(),_.isEmpty(e.currentSelectEntityId()))e.errorMessage="Please select an item in the dropdown",e.isLoading=!1;else switch(e.formMode="update",e.selectScreenState){case"system":e.currentSystemIndex=_.findIndex(e.systems,{attributes:{id:Number(e.currentSelectEntityId())}}),e.systemForm.populateForm(e.systems[e.currentSystemIndex]),e.screenHistory.unshift("SystemFormScreen");break;case"company":e.currentCompanyIndex=_.findIndex(e.companies,{attributes:{id:Number(e.currentSelectEntityId())}}),e.companyForm.populateForm(e.companies[e.currentCompanyIndex]),e.screenHistory.unshift("CompanyFormScreen");break;case"genre":e.currentGenreIndex=_.findIndex(e.genres,{attributes:{id:Number(e.currentSelectEntityId())}}),e.genreForm.populateForm(e.genres[e.currentGenreIndex]),e.screenHistory.unshift("GenreFormScreen")}return e.currentSelectEntityId(""),!1},e.generalDelete=function(){if(e.clearMessages(),_.isEmpty(e.currentSelectEntityId()))e.messageError="Select an item from the dropdown";else{e.isLoading=!0;var r;switch(e.selectScreenState){case"system":r=_.findIndex(e.systems,{attributes:{id:Number(e.currentSelectEntityId())}}),e.systems[r].remove().then(function(r){"success"===r.status&&(_.remove(e.systems,{attributes:{id:Number(e.currentSelectEntityId())}}),e.successMessage="The system has been removed",e.currentSelectEntityId(""),e.isLoading=!1,GameForm.controller.systems=_.pluck(e.systems,"attributes"))},e.reportInternalError);break;case"company":r=_.findIndex(e.companies,{attributes:{id:Number(e.currentSelectEntityId())}}),e.companies[r].remove().then(function(r){"success"===r.status&&(_.remove(e.companies,{attributes:{id:Number(e.currentSelectEntityId())}}),e.successMessage="The company has been removed",e.currentSelectEntityId(""),e.isLoading=!1,GameForm.controller.companies=_.pluck(e.companies,"attributes"))},e.reportInternalError);break;case"genre":r=_.findIndex(e.genres,{attributes:{id:Number(e.currentSelectEntityId())}}),e.genres[r].remove().then(function(r){"success"===r.status&&(_.remove(e.genres,{attributes:{id:Number(e.currentSelectEntityId())}}),e.successMessage="The genre has been removed",e.currentSelectEntityId(""),e.isLoading=!1,GameForm.controller.genres=_.pluck(e.genres,"attributes"))},e.reportInternalError)}}return!1}},e},GameTrackerAdmin.controller=function(){GameTrackerAdmin.vm.init()};var select2={};select2.config=function(e){return function(r,n){var t=$(r);n||(e.select2InitializationOptions?t.select2(e.select2InitializationOptions):t.select2(),t.change(function(){m.startComputation(),e.onchange(t.select2("val")),m.endComputation()})),t.select2("val",e.value)}},select2.view=function(e,r,n){var t=n?"select.form-control[multiple=true]":"select.form-control",a=function(){var e=[];return r&&(e=_.map(r,function(e){var r=_.isObject(e)?m("option",{value:e.id},e.name):m("option",e);return r})),e};return m(t,{config:select2.config(e)},[m("option"),a()])},m.module(document.body,GameTrackerAdmin);